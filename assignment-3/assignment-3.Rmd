---
title: "Assignment 3"
author: "Warren Jodjana"
date: "2023-10-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## Introduction

Unfortunately, Homicides remain a large issue at hand in large cities all over the world. In this lab, I'm going to be investigating homicides by tracts in two large cities, Los Angeles and New York. In the urban fabric of major cities like these two, incidents of homicides are often not evenly distributed but are clustered in specific areas due to specific socio-economic, environmental and cultural factors. Understanding these spatial distribution can directly influence public safety initiatives and can help for resource allocation for law enforcement and community-based intervention. Both New York and Los Angeles have unique urban histories, patterns of urban development and socio-cultural changes.By analyzing the distribution of homicides in specific tracts, I aim to investigate distinct spatial patterns that might shed light on the underlying causes and potential strategies for mitigation.

## Methods

My analysis started with obtaining and cleaning spatial data for both LA and NYC. The crime data comes from [Los Angeles Open Data Portal](https://data.lacity.org/Public-Safety/Crime-Data-from-2010-to-2019/63jg-8b9z) and [New York Open Data Portal](https://data.cityofnewyork.us/Public-Safety/NYC-crime/qb7u-rbmr/data). The tract data of Los Angeles comes from [City of Los Angeles Hub](https://geohub.lacity.org/search?collection=Dataset&q=Census%20Tracts) and the tract data of New York comes from [NYC Open Data](https://data.cityofnewyork.us/City-Government/2010-Census-Tracts/fxpq-c8ku). In the lab, all crime data is taken from 2015. Once preprocessed, a point-in-polygon (PIP) operation was employed, spatially joining the locations of individual homicide incidents with their corresponding tracts. Challenges encountered included missing data and differing coordinate reference systems (CRS) between the datasets. 


## Data Standardization

Before the spatial analysis could take place, it was necessary to ensure that the datasets were clean and standardized. Firstly, the datasets for NY and LA were filtered to only include homicides from the year 2015. For Los Angeles, it was to filter out "CRIMINAL HOMICIDE" from the dataset. While for New York, it was to filter out both "HOMICIDE-NEGLIGENT-VEHICLE" and "MURDER & NON-NEGL. MANSLAUGHTER", since their both considered homicides. Next, I handled any rows with missing or invalid (NA) latitude and longitude values and removed them. This is to ensure that all remaining data points can be mapped accurately. Then, I subset all the relevant columns including the unique crime identifier and the coordinates to use for analysis. Finally, I ensured that the latitude and longitude values were converted to numeric. Non-numeric coordinates can cause errors in mapping and spatial analysis.

## Spatial Data Operations

The operation used here for spatial data analysis is the point-in-polygon (PIP) method. The PIP method identifies which tracts (polygons) each homicide (point) belongs to. This allows for aggregation of crimes at tract level, effectively associating each tract with a count of homicides. Firstly, the datasets were converted from tabular (CSV) form to spatial point datasets. Then, to make sure that the points and polygons align properly, I transformed both datasets to the same CRS (4326). Then, perform the PIP operation by using spatial join, linking each point to the polygon area it resides. Next, aggregate each homicides by each tract to show the number of homocides within each tract were tallied. Finally, merge all data to showcase a visualization or map.



## Maps

### Los Angeles Points and Polygons
```{r LApts-polygons, include=TRUE}
## 1st layer (gets plotted first)
tm_shape(LAtracts) + tm_borders(alpha = 0.4) + 
  
  ## 2nd layer (overlay)
  tm_shape(LAcrime.pts) + tm_dots(size = 0.1, col="red") 
```


### Los Angeles Homicides by Tract


### New York Points and Polgyons


### New York Points and Polygons




## Discussion


## Environment Setup

Load Libraries
```{r load-libraries, message=FALSE, include=TRUE}
library(sf)
library(tmap)
library(leaflet)
library(data.table)
library(tidyverse)
```


## Los Angeles

### Clean and Wrangle Data

Load Data
```{r load-data, include=TRUE}
LAcrime <- fread("LA-data/LAPD2015_Violent.csv")

head(LAcrime)
```

Unique Code
```{r unique-code, include=TRUE}
unique(LAcrime$`Crime Code Description`)
```

Subset Data
```{r subset-data, include=TRUE}
LAcrime.df <- as.data.frame(LAcrime)
s1 <- subset(LAcrime.df, LAcrime.df$`Crime Code Description`=="CRIMINAL HOMICIDE") # base r subset
LAcrime.hom <- rbind(s1)

head(s1)
```

Saved Cleaned Data
```{r save-data, include=TRUE}
write.csv(LAcrime.hom,"LAcrime_hom.csv")
```

### Convert CSV to Points

Identify X,Y Locations
```{r xy-locations, include=TRUE}
glimpse(LAcrime.hom[,c("longitude","latitude")])
```

Check long/lat structure
```{r long-lat-str, include-TRUE}
str(LAcrime.hom[,c("longitude", "latitude")])
LAcrime.hom$latitude <- as.numeric(LAcrime.hom$latitude)
LAcrime.hom$longitude <- as.numeric(LAcrime.hom$longitude)
```

ID Missing Data
```{r missing-data, include=TRUE}
LAcrime.hom.na <- subset(LAcrime.hom, is.na(LAcrime.hom[,c("longitude", "latitude")]))

glimpse(LAcrime.hom.na) # observations
```

Remove Missing Values
```{r missing-values, include=TRUE}
LAcrime.hom2 <- na.omit(LAcrime.hom[,c("DR Number","longitude", "latitude")])
str(LAcrime.hom2)
```

Convert & Inspect
```{r convert-inspect, include=TRUE}
LAcrime.pts <- st_as_sf(LAcrime.hom2, coords = c("longitude","latitude"), crs = 4326)
plot(LAcrime.pts)
```
### Standardize CRS

Load & Inspect
```{r load-inspect, include=TRUE}
LAcrimes <- LAcrime.pts
LAtracts <- st_read("LA-data/LAC_Shape.shp")

```

Overlay Points & Polygons
```{r points-polygons, include=TRUE}
## 1st layer (gets plotted first)
tm_shape(LAtracts) + tm_borders(alpha = 0.4) + 
  
  ## 2nd layer (overlay)
  tm_shape(LAcrime.pts) + tm_dots(size = 0.1, col="red") 
```

Transform CRS
```{r transform-crs, include=TRUE}
CRS.new <- st_crs(LAtracts)
LAcrimes <- st_transform(LAcrimes, CRS.new)
```

### Point-in-Polygon (PIP)

Spatial Join
```{r spatial-join, include=TRUE}
crime_in_tract <- st_join(LAcrimes, LAtracts, join = st_within)
glimpse(crime_in_tract)
```

Count Crimes Per Tract
```{r crimes-per-tract, include=TRUE}
crime_tract_count <- as.data.frame(table(crime_in_tract$TRACTCE10))
glimpse(crime_tract_count)
```

Rename Column Names
```{r rename-columns, include=TRUE}
names(crime_tract_count) <- c("TRACTCE10","CrimeCt")
glimpse(crime_tract_count)

```

Merge Data
```{r merge-data, include=TRUE}
LAtracts_new <- merge(LAtracts, crime_tract_count, by="TRACTCE10")
glimpse(LAtracts_new)

```
### Conclusions

Visualize Output
```{r visualize-output, include=TRUE}
tm_shape(LAtracts_new) + tm_fill("CrimeCt", n=4, pal = "BuPu", title="LA Homicides in 2015")
```


## New York

### Clean and Wrangle Data

Load data
```{r load-dataNY, include=FALSE}
NYcrime <- fread("NYC-data/NYPD2015_Violent.csv")

head(NYcrime)
```

Unique Code
```{r unique-codeNY, include=TRUE}
unique(NYcrime$`OFNS_DESC`)
```

Subset Data
```{r subsetNY, include=TRUE}
NYcrime.hom <- NYcrime %>%
  filter(`OFNS_DESC` == "HOMICIDE-NEGLIGENT-VEHICLE" | `OFNS_DESC` == "MURDER & NON-NEGL. MANSLAUGHTER")

head(NYcrime.hom)
```
Saved Cleaned Data
```{r save-dataNY, include=TRUE}
write.csv(NYcrime.hom, "NYcrime_hom.csv")
```

### Convert CSV to Points

Identify X,Y Locations
```{r xy-locationsNY, include=TRUE}
glimpse(NYcrime.hom[,c("Longitude","Latitude")])
```

Check Long/Lat Structure
```{r long-latNY, include=TRUE}
str(NYcrime.hom[,c("Longitude", "Latitude")])
NYcrime.hom$Latitude <- as.numeric(NYcrime.hom$Latitude)
NYcrime.hom$Longitude <- as.numeric(NYcrime.hom$Longitude)
```
Remove Missing Values
```{r missing-valuesNY, include=TRUE}
NYcrime.hom2 <- na.omit(NYcrime.hom[,c("CMPLNT_NUM","Longitude", "Latitude")])
str(NYcrime.hom2)
```

Convert & Inspect
```{r convert-inspectNY, include=TRUE}
NYcrime.pts <- st_as_sf(NYcrime.hom2, coords = c("Longitude","Latitude"), crs = 4326)
plot(NYcrime.pts)
```
### Standardize CRS

Load & Inspect
```{r load-inspectNY, include=TRUE}
NYcrimes <- NYcrime.pts
NYtracts <- st_read("NYC-data/NYC_Shape.shp")

```
Overlay Points & Polygons
```{r points-polygonsNY, include=TRUE}
## 1st layer (gets plotted first)
tm_shape(NYtracts) + tm_borders(alpha = 0.4) + 
  
  ## 2nd layer (overlay)
  tm_shape(NYcrime.pts) + tm_dots(size = 0.1, col="blue") 
```
Transform CRS
```{r transform-crsNY, include=TRUE}
CRS.new <- st_crs(NYtracts)
NYcrimes <- st_transform(NYcrimes, CRS.new)
```

### Point-in-Polygon (PIP)

Spatial Join
```{r spatial-joinNY, include=TRUE}
crime_in_tractNY <- st_join(NYcrimes, NYtracts, join = st_within)
glimpse(crime_in_tractNY)
```

Count Crimes Per Tract
```{r crimes-per-tractNY, include=TRUE}
crime_tract_countNY <- as.data.frame(table(crime_in_tractNY$tractce))
glimpse(crime_tract_countNY)
```

Rename Column Names
```{r rename-columnsNY, include=TRUE}
names(crime_tract_countNY) <- c("tractce","CrimeCt")
glimpse(crime_tract_countNY)

```

Merge Data
```{r merge-dataNY, include=TRUE}
NYtracts_new <- merge(NYtracts, crime_tract_countNY, by="tractce")
glimpse(NYtracts_new)

```

### Conclusions

Visualize Output
```{r visualize-outputNY, include=TRUE}
tm_shape(NYtracts_new) + tm_fill("CrimeCt", n=4, pal = "BuPu", title="NY Homicides in 2015")
```







